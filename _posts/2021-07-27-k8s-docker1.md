---
title:  "[Docker&Kubernetes] Docker"
excerpt: "Docker"

categories:
  - Docker&Kubernetes
tags:
  - [Docker&Kubernetes]

toc: true
toc_sticky: true
 
date: 2021-07-27
last_modified_at: 2021-07-27
---
> 기존에 알아야되는 내용들
    - 쿠버네티스는 컨테이너를 오케스트레이션하며, 오케스트레이션하는 기본 단위는 파드
    - 파드는 컨테이너로 이루어져있음

## 파드, 컨테이너, 도커, 쿠버네티스의 관계
파드들은 워커 노드라는 노드 단위로 관리하며, 워커 노드와 마스터 노드가 모여 쿠버네티스 클러스터가 됨. 그리고 파드는 1개 이상의 컨테이너로 이루어져 있음.
파드는 쿠버네티스로부터 IP를 받아 컨테이너가 외부와 통신할 수 있는 경로를 제공. 그리고 컨테이너들이 정상적으로 작동하는지 확인하고 네트워크나 저장 공간을 서로 공유하게 함.
컨테이너를 돌보는 것이 파드고, 파드를 돌보는 것이 쿠버네티스 워커 노드이며, 워커 노드를 돌보는 것이 쿠버네티스 마스터.

가장 기본인 컨테이너는 하나의 운영 체제 안에서 커널을 공유하며 개별적인 실행 환경을 제공하는 격리된 공간. 개별적인 실행 환경이란 CPU, 네트워크, 메모리와 같은 시스템 자원을 독자적으로 사용하도록 할당된 환경. 개별적인 실행 환경에선 실행되는 프로세스를 구분하는 ID도 컨테이너 안에 격리돼 관리. 따라서 각 컨테이너 내부에서 실행되는 앱들은 서로 영향을 미치지않고 독립적으로 작동.

- 도커 : 컨테이너를 사용하는 방법을 명령어로 정리한 것

도커를 사용하면 사용자가 서로 신경쓰지 않아도 컨테이너를 생성할 때 개별적인 실행 환경을 분리하고 자원을 할당

### Different kinds of Container controller
- Containerd
- CRI-O
- Kata Containers
- Docker

## Docker
도커의 학습 과정
이미지 찾기 -> 실행 -> 디렉터리와 연결 -> 삭제

컨테이너 이미지는 그대로 사용할수 없고 도커와 같은 CRI로 불러들여야 컨테이너가 실제로 작동. 이는 실행 파일과 실행된 파일 관계로 볼 수 있음. 따라서 컨테이너를 삭제할 때는 내려받은 이미지와 이미 실행된 컨테이너를 모두 삭제해야만 디스크의 용량을 온전히 확보할 수 있음.

### Container Image
이미지는 registry라는 저장소에 모여 있음. registry는 docker hub같이 유명한 registry일 수도 있고, 내부에 구축한 registry일 수도 있음.
```powershell
docker search <검색어>
```
로 특정한 이름을 포함하는 이미지를 찾음.
- INDEX : 이미지가 저장된 레지스트리의 이름
- NAME : 검색된 이미지 이름. 공식 이미지를 제외한 니머지는 '레지스트리 주소/저장소 소유자/이미지 이름' 형태
- DESCRIPTION : 이미지에 대한 설명
- STARS : 해당 이미지를 내려받은 사용자에게 받은 평가 횟수. 숫자가 클수록 신뢰성 높은 이미지
- OFFICIAL : [OK]표시는 해당 이미지에 포함된 앱, 미들웨어 등을 개발한 업체에서 공식적으로 제공한 이미지
- AUTOMATED : [OK]표시는 도커 허브에서 자체적으로 제공하는 이미지 빌드 자동화 기능을 활용해 생성한 이미지를 의미

```powershell
docker pull nginx
```
이미지를 내려받을 때 사용하는 태그, 레이어, 이미지의 고유 식별 값 등을 볼 수 있음.
- tag : Using default tag와 함께 뒤에 따라오는 태그 이름을 통해 이미지를 내려받을 때 사용한 태그를 알 수 있음.
- layer : pull을 수행해 내려받은 레이어. 하나의 이미지는 여러 개의 레이어로 이루어져 있어서 레이어마다 Pull complete 메시지가 발생.
- digest : 이미지의 고유 식별자로, 이미지에 포함된 내용과 이미지의 생성 환경을 식별할 수 있음. 식별자는 hash함수로 생성되며 이미지가 동일한지 검증하는데 사용.
- status : 이미지를 내려받은 레지스트리, 이미지, 태그 등의 상태 정보를 확인할 수 있음. 형식은 '레지스트리 이름/이미지 이름:태그'

### Image Tag
태그는 이름이 동일한 이미지에 추가하는 식별자. 이미지를 내려받거나 이미지를 기반으로 컨테이너를 구동할 때는 이미지 이름만 사용하고 태그를 명시하지 않으면 latest 태그를 기본으로 사용. 안정화 버전은 stable로 실행.

### 이미지의 레이어 구조
```powershell
docker pull nginx:stable
```

```powershell
```

```powershell
```

```powershell
```

```powershell
```

