<!DOCTYPE html>
<html lang="ko" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Kubernetes에서 kafka를 사용할때 kafka의 데이터 저장소는 어떤 것이 적절한지에 대한 글이다.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://stevearsenelee.iptime.org/docs/data-integration/kafka/kafka-storage/">
  <meta property="og:site_name" content="LogLee&#39;s Training Ground">
  <meta property="og:title" content="Kafka의 저장소">
  <meta property="og:description" content="Kubernetes에서 kafka를 사용할때 kafka의 데이터 저장소는 어떤 것이 적절한지에 대한 글이다.">
  <meta property="og:locale" content="ko">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Kafka의 저장소 | LogLee&#39;s Training Ground</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://stevearsenelee.iptime.org/docs/data-integration/kafka/kafka-storage/">
<link rel="stylesheet" href="/book.min.e9f68c3fff3d8236a489d16a9caf6de5e4d1a29c20eb4b5524e42cd30be4d319.css" integrity="sha256-6faMP/89gjakidFqnK9t5eTRopwg60tVJOQs0wvk0xk=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/kr.search.min.a137a1fa7ffc8a7c0b9c41e294e33bd53d785a720c9210f8de8eeb1dd1f0a177.js" integrity="sha256-oTeh&#43;n/8inwLnEHilOM71T14WnIMkhD43o7rHdHwoXc=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>LogLee&#39;s Training Ground</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-79150fdf9dbf158df9c917a93d39407f" class="toggle"  />
    <label for="section-79150fdf9dbf158df9c917a93d39407f" class="flex justify-between">
      <a href="/docs/infra/" class="">Infra</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-afa7bc76ec3321dc3793f4204885e0ab" class="toggle"  />
    <label for="section-afa7bc76ec3321dc3793f4204885e0ab" class="flex justify-between">
      <a href="/docs/infra/kvm/" class="">KVM</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3f41a0b8f3b7286a296b17538ec448af" class="toggle"  />
    <label for="section-3f41a0b8f3b7286a296b17538ec448af" class="flex justify-between">
      <a href="/docs/infra/kubernetes/" class="">Kubernetes</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8b1ecbff7b9f24569532f1fb1f37fd97" class="toggle"  />
    <label for="section-8b1ecbff7b9f24569532f1fb1f37fd97" class="flex justify-between">
      <a href="/docs/data-engineering/" class="">Data Engineering</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-284624ec7b613288f08ca4735aa73b9b" class="toggle"  />
    <label for="section-284624ec7b613288f08ca4735aa73b9b" class="flex justify-between">
      <a href="/docs/data-engineering/hadoop/" class="">Hadoop</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c91f99bd61bd7a25ae2813b87d79c33a" class="toggle"  />
    <label for="section-c91f99bd61bd7a25ae2813b87d79c33a" class="flex justify-between">
      <a href="/docs/data-engineering/modeling/" class="">Modeling</a>
    </label>
  

          
  <ul>
    
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-86d5be1a8f57012d1ea9e463f571db7f" class="toggle" checked />
    <label for="section-86d5be1a8f57012d1ea9e463f571db7f" class="flex justify-between">
      <a href="/docs/data-integration/" class="">Data Integration</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b2cd59148ccf9b8d3a917d917ae2a406" class="toggle" checked />
    <label for="section-b2cd59148ccf9b8d3a917d917ae2a406" class="flex justify-between">
      <a href="/docs/data-integration/kafka/" class="">Kafka</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4a316c2f6a0a797b8405c6d80cc14382" class="toggle"  />
    <label for="section-4a316c2f6a0a797b8405c6d80cc14382" class="flex justify-between">
      <a href="/docs/data-lake-platform/" class="">Data Lake Platform</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5dcab46997e9d19d75a2822ca5e743f9" class="toggle"  />
    <label for="section-5dcab46997e9d19d75a2822ca5e743f9" class="flex justify-between">
      <a href="/docs/data-lake-platform/ceph/" class="">Ceph</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ba927d26d986ad406ba7c1c000fff87c" class="toggle"  />
    <label for="section-ba927d26d986ad406ba7c1c000fff87c" class="flex justify-between">
      <a href="/docs/data-processing/" class="">Data Processing</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ab37952be8fe534502230c818e8b611b" class="toggle"  />
    <label for="section-ab37952be8fe534502230c818e8b611b" class="flex justify-between">
      <a href="/docs/data-processing/flink/" class="">Flink</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5cdf1754fdf767f4d7e6b8fb75b850fb" class="toggle"  />
    <label for="section-5cdf1754fdf767f4d7e6b8fb75b850fb" class="flex justify-between">
      <a href="/docs/language/" class="">Language</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8bff7ae517186b2d376a0661467cef2d" class="toggle"  />
    <label for="section-8bff7ae517186b2d376a0661467cef2d" class="flex justify-between">
      <a href="/docs/observability/" class="">Observability</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8bd6aac4580b36d82077704ed5049b20" class="toggle"  />
    <label for="section-8bd6aac4580b36d82077704ed5049b20" class="flex justify-between">
      <a href="/docs/observability/logs/" class="">Logs</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3820b01d8d343a30aa49f2bd3d0ac76c" class="toggle"  />
    <label for="section-3820b01d8d343a30aa49f2bd3d0ac76c" class="flex justify-between">
      <a href="/docs/observability/metrics/" class="">Metrics</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-27eb68f1910975dd7e21ea458d19f57f" class="toggle"  />
    <label for="section-27eb68f1910975dd7e21ea458d19f57f" class="flex justify-between">
      <a href="/docs/observability/traces/" class="">Traces</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-78891673ccb2c2d2b66a96ea50ab1361" class="toggle"  />
    <label for="section-78891673ccb2c2d2b66a96ea50ab1361" class="flex justify-between">
      <a href="/docs/others/" class="">Others</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6604ba009ff4797e1d1b8afddb383f03" class="toggle"  />
    <label for="section-6604ba009ff4797e1d1b8afddb383f03" class="flex justify-between">
      <a href="/docs/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/" class="">알고리즘</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-024768ea14361a69ff0996148c6f4523" class="toggle"  />
    <label for="section-024768ea14361a69ff0996148c6f4523" class="flex justify-between">
      <a href="/docs/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/a-really-important/" class="">a-really-important</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-be397912fe8ba62b06f588cc48b4f0f2" class="toggle"  />
    <label for="section-be397912fe8ba62b06f588cc48b4f0f2" class="flex justify-between">
      <a href="/docs/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/dp/" class="">dp</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6d3eec73dbffc1409d9c27d08f2594eb" class="toggle"  />
    <label for="section-6d3eec73dbffc1409d9c27d08f2594eb" class="flex justify-between">
      <a href="/docs/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/sorting/" class="">sorting</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e543a726dbcf386b40ea0cb3c4a59f1d" class="toggle"  />
    <label for="section-e543a726dbcf386b40ea0cb3c4a59f1d" class="flex justify-between">
      <a href="/docs/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/%EC%99%84%EC%A0%84%ED%83%90%EC%83%89/" class="">완전탐색</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d7e1497bbb4a05194486c8bb2b0ea79a" class="toggle"  />
    <label for="section-d7e1497bbb4a05194486c8bb2b0ea79a" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/" class="">컴퓨터이론</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a1c99ab2d40536151b21eb12a5041410" class="toggle"  />
    <label for="section-a1c99ab2d40536151b21eb12a5041410" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/" class="">네트워크</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2268fd08902c3bcc533339d8cbf128ef" class="toggle"  />
    <label for="section-2268fd08902c3bcc533339d8cbf128ef" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/" class="">데이터베이스</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2998a9560058ec62c67d1a55ea134d38" class="toggle"  />
    <label for="section-2998a9560058ec62c67d1a55ea134d38" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4/" class="">디자인패턴</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-055d0164778e6e1df37e6d55c5d9cf85" class="toggle"  />
    <label for="section-055d0164778e6e1df37e6d55c5d9cf85" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/" class="">운영체제</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3a909f63114456639d5607c0ecf991ab" class="toggle"  />
    <label for="section-3a909f63114456639d5607c0ecf991ab" class="flex justify-between">
      <a href="/docs/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%B4%EB%A1%A0/%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0/" class="">자료구조</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-62d25428b0c6e0c722ae043a75c5de50" class="toggle"  />
    <label for="section-62d25428b0c6e0c722ae043a75c5de50" class="flex justify-between">
      <a href="/docs/%ED%8A%B8%EB%9F%AC%EB%B8%94%EC%8A%88%ED%8C%85/" class="">트러블슈팅</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Kafka의 저장소</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#kafka의-저장-방식-순서">Kafka의 저장 방식 순서</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><p>Kubernetes에서 kafka를 사용할때 kafka의 데이터 저장소는 어떤 것이 적절한지에 대한 글이다.</p>
<blockquote>
<p>Efficient data storage is essential for Strimzi to operate effectively, and block storage is strongly recommended. Strimzi has been tested only with block storage, and file storage solutions like NFS are not guaranteed to work.</p></blockquote>
<p>Strimzi는 block storage만을 대상으로 테스트 및 인증했으며, NFS 기반 스토리지는 다음과 같은 이유로 사용을 권장하지 않음</p>
<ul>
<li>동시 접근 시 locking 이슈 발생</li>
<li>rename, append 등 Kafka가 요구하는 파일 시스템 특성과 충돌 가능</li>
<li>Latency 및 Throughput 불안정성 (특히 segment flush, recovery 시 심각)</li>
<li>File handle 누수나 lease 문제가 발생할 수 있음</li>
</ul>
<h3 id="kafka의-저장-방식-순서">
  Kafka의 저장 방식 순서
  <a class="anchor" href="#kafka%ec%9d%98-%ec%a0%80%ec%9e%a5-%eb%b0%a9%ec%8b%9d-%ec%88%9c%ec%84%9c">#</a>
</h3>
<ol>
<li>log message를 segment file에 append</li>
<li>memory flush → fsync to disk</li>
<li>segment가 일정 크기 도달 시 rename(segment.000.log → segment.001.log)</li>
<li>index 파일 동기화 및 offset 확인</li>
<li>restart 시 파일 정합성 체크</li>
</ol>
<p>→ 위 작업들은 block-level consistency와 atomic operation 보장을 전제로 설계됨</p>
<p>즉, Kafka는 log-segment 기반으로</p>
<ul>
<li>데이터는 지속적으로 append-write 되고</li>
<li>주기적으로 fsync, flush, segment 파일 rename 작업이 발생</li>
<li>재시작 시 segment recovery를 위해 .log, .index 파일의 정합성이 매우 중요</li>
</ul>
<p>하지만… NFS는</p>
<ul>
<li>client마다 lock 동작 방식 다름 → flock이나 fcntl 무력화 가능</li>
<li>파일 locking과 rename에 제약이 있으며</li>
<li>Kafka는 재시작 시 log/index 파일을 복구 → NFS는 file handle 누락, incomplete rename으로 인해 fail 가능</li>
<li>write latency가 높고, IOPS가 낮은 경우가 많음
-&gt; Kafka의 안정성과 성능에 치명적일 수 있음</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#kafka의-저장-방식-순서">Kafka의 저장 방식 순서</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












