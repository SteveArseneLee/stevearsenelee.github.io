<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>KVM on LogLee's Training Ground</title><link>https://stevearsenelee.github.io/docs/infra/kvm/</link><description>Recent content in KVM on LogLee's Training Ground</description><generator>Hugo</generator><language>ko</language><lastBuildDate>Tue, 15 Apr 2025 14:56:52 +0900</lastBuildDate><atom:link href="https://stevearsenelee.github.io/docs/infra/kvm/index.xml" rel="self" type="application/rss+xml"/><item><title>이걸 해볼까요</title><link>https://stevearsenelee.github.io/docs/infra/kvm/whatswrong/</link><pubDate>Tue, 15 Apr 2025 14:56:52 +0900</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/whatswrong/</guid><description>&lt;h3 id="worker-node에-role-부여하기">
 Worker Node에 Role 부여하기
 &lt;a class="anchor" href="#worker-node%ec%97%90-role-%eb%b6%80%ec%97%ac%ed%95%98%ea%b8%b0">#&lt;/a>
&lt;/h3>
&lt;pre tabindex="0">&lt;code>kubectl label node {node명} node-role.kubernetes.io/worker=worker
&lt;/code>&lt;/pre>&lt;h3 id="nfs-서버-연결-및-persistentvolume-storageclass-설정">
 NFS 서버 연결 및 PersistentVolume, StorageClass 설정
 &lt;a class="anchor" href="#nfs-%ec%84%9c%eb%b2%84-%ec%97%b0%ea%b2%b0-%eb%b0%8f-persistentvolume-storageclass-%ec%84%a4%ec%a0%95">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>NFS 서버 확인&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>IP 확인&lt;/li>
&lt;li>공유 디렉토리 : e.g. &lt;code>/srv/nfs/k8s&lt;/code>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>NFS 서버 설치하기&lt;/p></description></item><item><title>Hello</title><link>https://stevearsenelee.github.io/docs/infra/kvm/vm-metadata/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/vm-metadata/</guid><description>&lt;p>인프라 구성은 다음과 같다.&lt;/p>
&lt;h3 id="home192168019">
 Home(192.168.0.19)
 &lt;a class="anchor" href="#home192168019">#&lt;/a>
&lt;/h3>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>VM명&lt;/th>
 &lt;th>Disk&lt;/th>
 &lt;th>CPU&lt;/th>
 &lt;th>RAM&lt;/th>
 &lt;th>Disk 사이즈&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>ctrl-node&lt;/td>
 &lt;td>/mnt/kvm-pool/ctrl-node.qcow2&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>2GB&lt;/td>
 &lt;td>40GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-m1&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-m1.qcow2&lt;/td>
 &lt;td>3&lt;/td>
 &lt;td>8GB&lt;/td>
 &lt;td>30GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-m2&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-m2.qcow2&lt;/td>
 &lt;td>3&lt;/td>
 &lt;td>8GB&lt;/td>
 &lt;td>30GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w1&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-w1.qcow2&lt;/td>
 &lt;td>3&lt;/td>
 &lt;td>16GB&lt;/td>
 &lt;td>50GB + Ceph 100GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w2&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-w2.qcow2&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>16GB&lt;/td>
 &lt;td>50GB + Ceph 100GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>총합&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>15&lt;/td>
 &lt;td>50GB&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 id="test192168018">
 Test(192.168.0.18)
 &lt;a class="anchor" href="#test192168018">#&lt;/a>
&lt;/h3>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>VM명&lt;/th>
 &lt;th>Disk&lt;/th>
 &lt;th>CPU&lt;/th>
 &lt;th>RAM&lt;/th>
 &lt;th>Disk 사이즈&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>k8s-m3&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-m3.qcow2&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>8GB&lt;/td>
 &lt;td>30GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w3&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-w3.qcow2&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>16GB&lt;/td>
 &lt;td>50GB + Ceph 100GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w4&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-w4.qcow2&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>16GB&lt;/td>
 &lt;td>50GB + Ceph 100GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w5&lt;/td>
 &lt;td>/mnt/kvm-pool/k8s-w5.qcow2&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>16GB&lt;/td>
 &lt;td>50GB + Ceph 100GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>nfs-server&lt;/td>
 &lt;td>/mnt/kvm-pool/nfs.qcow2&lt;/td>
 &lt;td>1&lt;/td>
 &lt;td>2GB&lt;/td>
 &lt;td>30GB + NFS 300GB&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>총합&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>17&lt;/td>
 &lt;td>58GB&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 id="ip">
 IP
 &lt;a class="anchor" href="#ip">#&lt;/a>
&lt;/h3>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>Key&lt;/th>
 &lt;th>Value&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>Subnet&lt;/td>
 &lt;td>192.168.0.0/24&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>Gateway&lt;/td>
 &lt;td>192.168.0.1&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>Name Servers&lt;/td>
 &lt;td>8.8.8.8, 1.1.1.1&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>Search Domains&lt;/td>
 &lt;td>(비워도 무방)&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>VM 이름&lt;/th>
 &lt;th>Address 입력값(고정 IP)&lt;/th>
 &lt;th>생성 여부&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>ctrl-node&lt;/td>
 &lt;td>192.168.0.100/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-m1&lt;/td>
 &lt;td>192.168.0.101/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-m2&lt;/td>
 &lt;td>192.168.0.102/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-m3&lt;/td>
 &lt;td>192.168.0.103/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>worker&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w1&lt;/td>
 &lt;td>192.168.0.111/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w2&lt;/td>
 &lt;td>192.168.0.112/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w3&lt;/td>
 &lt;td>192.168.0.113/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w4&lt;/td>
 &lt;td>192.168.0.114/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w5&lt;/td>
 &lt;td>192.168.0.115/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>nfs-server&lt;/td>
 &lt;td>192.168.0.200/24&lt;/td>
 &lt;td>O&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="gpu있는-서버192168019">
 GPU있는 서버(192.168.0.19)
 &lt;a class="anchor" href="#gpu%ec%9e%88%eb%8a%94-%ec%84%9c%eb%b2%84192168019">#&lt;/a>
&lt;/h3>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>VM명&lt;/th>
 &lt;th>Disk&lt;/th>
 &lt;th>CPU&lt;/th>
 &lt;th>RAM&lt;/th>
 &lt;th>Disk 사이즈&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>k8s-w3&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>20&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-w4&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>18&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8w-w5&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>18&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>총합||16vcpu|62gb|&lt;/p></description></item><item><title>KVM에서 사용할 Storage 설정</title><link>https://stevearsenelee.github.io/docs/infra/kvm/storage-settings/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/storage-settings/</guid><description>&lt;h3 id="1-logical-volume-생성">
 1. Logical Volume 생성
 &lt;a class="anchor" href="#1-logical-volume-%ec%83%9d%ec%84%b1">#&lt;/a>
&lt;/h3>
&lt;p>물리 저장소에 논리 볼륨을 먼저 할당해준다&lt;/p></description></item><item><title>VM 사이즈 변경...</title><link>https://stevearsenelee.github.io/docs/infra/kvm/vm-calc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/vm-calc/</guid><description>&lt;p>vm들을 k8s로 올려놨는데, 너무 부하가 큰듯하다&amp;hellip; 모든걸 다시 계산해봐야겠다.&lt;/p>
&lt;h3 id="main-server">
 Main server
 &lt;a class="anchor" href="#main-server">#&lt;/a>
&lt;/h3>
&lt;p>cpu 16, memory 64gb, ssd 1tb
master 2대, worker 2대,&lt;/p></description></item><item><title>VM 생성</title><link>https://stevearsenelee.github.io/docs/infra/kvm/vm-creattion-guide/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/vm-creattion-guide/</guid><description>&lt;p>[준비 단계]&lt;/p>
&lt;ol>
&lt;li>os image 다운로드 받아놓기&lt;/li>
&lt;li>Resource 용량 산정 (cpu, memory, disk)&lt;/li>
&lt;li>ip 설계&lt;/li>
&lt;li>(선택) 물리 서버가 n대라면 VM 분배 계획&lt;/li>
&lt;/ol>
&lt;p>[실습 단계]&lt;/p></description></item><item><title>VM 생성 간단</title><link>https://stevearsenelee.github.io/docs/infra/kvm/vm-install-simple/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://stevearsenelee.github.io/docs/infra/kvm/vm-install-simple/</guid><description>&lt;p>Home에는&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>set -e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;[HOME SERVER - STORAGE POOL &amp;amp; VOLUME SETUP]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># [1] Storage Pools 생성&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;[1] Creating storage pools...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo mkdir -p /mnt/kvm-pool /mnt/ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chown libvirt-qemu:kvm /mnt/kvm-pool /mnt/ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chmod &lt;span style="color:#ae81ff">770&lt;/span> /mnt/kvm-pool /mnt/ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-define-as --name kvm-pool --type dir --target /mnt/kvm-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-build kvm-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-start kvm-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-autostart kvm-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-define-as --name ceph-pool --type dir --target /mnt/ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-build ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-start ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo virsh pool-autostart ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># [2] Volume 생성&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;[2] Creating VM OS disks...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /mnt/kvm-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f qcow2 ctrl-node.qcow2 40G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f qcow2 k8s-m1.qcow2 30G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f qcow2 k8s-m2.qcow2 30G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f qcow2 k8s-w1.qcow2 50G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f qcow2 k8s-w2.qcow2 50G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;[3] Creating Ceph raw disks...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /mnt/ceph-pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f raw k8s-w1-ceph.img 100G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo qemu-img create -f raw k8s-w2-ceph.img 100G
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;[HOME SERVER SETUP COMPLETE]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Test에는&lt;/p></description></item></channel></rss>